описание решения задачи

---

В админке битрикс создадим два свойства заказа:

    1) Списать ли баллы, isBonusesUsed, Y/N
    2) Сколько списать баллов, spentBonusesCount, Число

---

Перерасчитываем заказ. Для начала получим всю нужную информацию о баллах пользователя (файл 1.php). На странице оформления заказа пользователь применяет баллы, и списывает какое-то их количество. Проверяется, хватает ли у пользователя баллов. Согласно условиям задачи, максимум для товаров со скидкой можно оплатить 10% баллами, а для простых товаров - 15%. Берем все товары в корзине, суммируем 10% их стоимости если товар со скидкой, и 15% если без - получаем максимально применимое количество баллов в заказе, применяем баллы, или не применяем (файл 2.php). Событие сохранения заказа отслеживается, и если баллы были применены - списывает их со счета пользователя, и применяет бесплатную доставку, если позволяют условия и уровень карты. Или начисляет баллы на карту (файл 3.php).

Файлы:
1.php - Выборка из таблицы уровней 
2.php - Применение баллов
3.php - События
